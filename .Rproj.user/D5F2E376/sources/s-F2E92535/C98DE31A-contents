---
title: "PM566 Final"
author: "Changqing Su"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE

---

```{r setup, message=FALSE, echo=FALSE, warning=FALSE}

library(data.table)
library(tidyverse)
library(dplyr)
library(plotly)
library(DT)
library(knitr)

# Initialize code chunk options
opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  eval=TRUE,
  echo = F,
  cache = FALSE,
  fig.width = 7, 
  fig.align = 'center',
  fig.asp = 0.618,
  out.width = "700px",
  class.source = "code-r")
```

<br>

# Introduction

At the end of 2019, a novel coronavirus was identified as the cause of a cluster of pneumonia cases in China. It rapidly spread, and resulted in an epidemic throughout the world. In February 2020, the World Health Organization designated the disease COVID-19, which stands for coronavirus disease 2019. This report is designed to explore the association between COVID-19 death and state, sex, age groups.

<br>

# Methods

<br>

The data was obtained from the US CDC, Centers of Disease Control and Prevention on Oct 17, 2020. The data include deaths due to coronavirus disease 2019 (COVID-19), pneumonia, and influenza reported to NCHS by sex, age group and state. \
There age group variable contains overlapping data. Therefore, only portion of the data was used. \
The proportionate mortality ratio (PMR) was obtained by using COVID-19 deaths/total deaths. \

<br>

# Preliminary Results

<br>

```{r, warning=FALSE,message=FALSE,echo = FALSE}
source("Mid_data.R")
```

```{r midtermplots, class.source="code-r-small"}

figure1=covid_2  %>%
plot_ly(x = ~`Age group`, y = ~PMR, 
        type = 'scatter', mode = 'markers', color = ~State,
        size = ~`Total Deaths`, sizes = c(2, 30), 
         marker = list(sizemode='diameter', opacity=0.6)) %>%
  layout(title = "Age groups vs PMR by states",
                  yaxis = list(title = "Proportionate Mortality Ratio"), xaxis = list(title = "Age groups"))
  

figure2= covid_2 %>%
  plot_ly(x=~State , y = ~`COVID-19 Deaths`, color = ~Sex) %>%
  layout(title = "State vs COVID-19 Deaths by Sex",
                  yaxis = list(title = "COVID-19 Deaths"), xaxis = list(title = "State"))
  

figure3 =covid_2 %>%
  plot_ly(x=~`Age group` , y = ~PMR, color = ~Sex) %>%
  add_bars() %>%
  layout(title = "Age group vs PMR by Sex",
                  yaxis = list(title = "Proportionate Mortality Ratio"), xaxis = list(title = "Age group "),barmode = "stack") 




g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  lakecolor = toRGB('white')
)

figure4=plot_geo(covid_state) %>%
  add_trace(
    z = ~PMR, text = ~State, span = I(0),
    locations = state.abb, locationmode = 'USA-states' , color="Reds") %>% 
  layout(title='Covid PMR Map',
         geo = g)


```

### Covid-19 in State Level {.tabset}

#### Figure 1

<br>

```{r PMR within different age groups by states, echo=FALSE}
figure4
```

#### Table 1

```{r , echo=FALSE}
knitr::kable(head(covid_simp))
```

### {-}

According to Figure 1, New York has the highest proportionate mortality ratio of COVID-19. This may be caused by small living space per capita. Since the virus can spread from an infected personâ€™s mouth or nose in small liquid particles, others are very easily get infected when staying with infected people. \
According to Table 1, California also has a large number of deaths due to Covid-19, but California has a very low PMR comparing to New York. This may be because that the state government did a better job on stopping the spread of Covid-19.


<br>

### Figure 2

<br>

```{r Covid deaths within different sex by states, echo=FALSE}
figure2
```

<br>

According to Figure 2, New York, California, Florida, and Texas shows that more males died from Covid-19 than females. Other states had close numbers between males and females. This may be because that males are more likely to have social communications with others, and they have a larger chance to contact with infect people.

<br>

### Figure 3

<br>

```{r PMR within different sex by age groups, echo=FALSE}
figure3
```

<br>

According to Figure 3, the Proportionate Mortality Ratio increases as the age increases. Older people are more likely to die due to Covid-19. Sex does not affect Proportionate Mortality Ratio of Covid-19 in this plot.

<br>

# Conclusion

In conclusion, the number of deaths due to Covid-19 varies in different states, sex, and age groups. \
The New York State has the highest proportionate mortality ratio due to COVID-19. Generally more people die from COVID-19 in New York State. \
Slightly more males died from COVID-19 than females. But the PMR does not vary between males and females. \
In addition, older people (greater than 65 years old) are more likely to die (more than 8%) because of COVID-19. 
